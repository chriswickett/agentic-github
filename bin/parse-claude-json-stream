#!/usr/bin/env bash
while IFS= read -r line; do
  echo "$line" | jq -r '
    if .type == "assistant" and .message.content then
      [.message.content[] |
        if .type == "text" then
          .text
        elif .type == "tool_use" then
          (.name + ": " + (
            if .input.file_path then
              (.input.file_path | split("/") | last)
            elif .input.command then
              .input.command
            elif .input.pattern then
              .input.pattern
            else
              ""
            end
          ))
        else
          empty
        end
      ] | join("\n\n")
    elif .type == "result" and (.total_cost_usd // 0) > 0 then
      "\nTotal cost: $\(.total_cost_usd | . * 100 | round / 100)"
    else
      empty
    end
  ' 2>/dev/null
done
